{% extends "base.html" %}

{% block title %}Step 3 - Summary{% endblock %}

{% block content %}

<h1>Trailer Selection</h1>
<h1>Step 3: Summary</h1>
{% load custom_filters %}
{% if coffee_data and milkshake_data %}
    <p style="color: green;"><strong>Step 2 completed! Here is the summary.</strong></p>
{% else %}
    <p style="color: red;"><strong>Please complete Step 2 first.</strong></p>
{% endif %}

<table style="opacity: {% if coffee_data and milkshake_data %}1{% else %}0.5{% endif %};">
    <thead>
        <tr>
            <th>Day</th>
            <th>Trailer #</th>
            <th>Coffee %</th>
            <th>Milkshake %</th>
        </tr>
    </thead>
    <tbody>
        {% for day, coffee_list in coffee_data.items %}
        {% for i in coffee_list|length|times %}
        {% load custom_filters %}
            <tr>
                <td>{{ day }}</td>
                <td>Trailer {{ i }}</td>
                <td>{{ coffee_list|default_if_none:"0" }}</td>
                <td>{{ milkshake_data|get_item:day|default_if_none:"0" }}</td>
            </tr>
        {% endfor %}
        {% endfor %}
    </tbody>
</table>

<h2>Total Coffee: {{ total_coffee }}%</h2>
<h2>Total Milkshake: {{ total_milkshake }}%</h2>

<!-- Reset & Start Over Button -->
<form method="post" action="{% url 'trailer_selection' %}">
    {% csrf_token %}
    <button type="submit" name="reset" style="background-color: rgb(151, 44, 44); color: white; border: none; padding: 10px 15px; cursor: pointer;">
        Reset & Start Over
    </button>
</form>

{% if not coffee_data or not milkshake_data %}
    <script>
        setTimeout(() => {
            window.location.href = "{% url 'trailer_step2' %}"; // Redirect to Step 2
        }, 5000);  // Redirect after 5 seconds
    </script>
{% endif %}

{% endblock %}


<!--
<form method="post">
    {% csrf_token %}
    <table>
        <thead>
            <tr>
                <th>Day</th>
                <th>Trailers</th>
                <th>Coffee %</th>
                <th>Milkshake %</th>
            </tr>
        </thead>
        <tbody>
            {% if days %}
                {% for day in days %}
                <tr>
                    <td>{{ day.day }}</td>
                    <td><input type="number" name="trailers_{{ day.id }}" value="{{ day.trailers_count }}" min="0"></td>
                    <td><input type="number" name="coffee_{{ day.id }}" value="{{ day.coffee_percentage }}" step="0.1" min="0" max="100"></td>
                    <td><input type="number" name="milkshake_{{ day.id }}" value="{{ day.milkshake_percentage }}" step="0.1" min="0" max="100"></td>
                </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="7">No data available</td></tr>
            {% endif %}
        </tbody>
        
    </table>
    <button type="submit">Submit</button>
</form>

<h3>Totals</h3>
<ul>
    <li>Total Coffee: {{ total_coffee }}%</li>
    <li>Total Milkshake: {{ total_mlsh }}%</li>
    <li>Total 23%: {{ total_23 }}</li>
</ul>
-->