{% extends "base.html" %}

{% block title %}Update Weekly Schedule{% endblock %}

{% block content %}
<div class="container">
    <h2>Update Google Sheet for Weekly Schedule</h2>

    <!-- Display Success or Error Messages -->
    {% if messages %}
        <div>
            {% for message in messages %}
                <p style="color: {% if message.tags == 'success' %}green{% else %}red{% endif %};">
                    {{ message }}
                </p>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Form for User Input -->
    <form id="dateForm" method="POST">
        {% csrf_token %}

        <label for="start_date">Start Date (Monday):</label>
        <input type="date" id="start_date" name="start_date" required>

        <label for="end_date">End Date (Sunday):</label>
        <input type="date" id="end_date" name="end_date" required>

        <p id="error_message" style="color: red;"></p>

        <button type="submit">Update Sheet</button>
    </form>

    <!-- Debugging Output -->
    <p id="debug_output"></p>
</div>

<script>
    document.getElementById("dateForm").addEventListener("submit", function(event) {
        event.preventDefault();  // Stop form submission

        const startDateInput = document.getElementById("start_date").value;
        const endDateInput = document.getElementById("end_date").value;
        const errorMessage = document.getElementById("error_message");
        const debugOutput = document.getElementById("debug_output");

        if (!startDateInput || !endDateInput) {
            errorMessage.textContent = "Both dates must be selected.";
            return false;
        }

        // Convert string to Date objects (YYYY-MM-DD format)
        const startDate = new Date(startDateInput + "T00:00:00Z");
        const endDate = new Date(endDateInput + "T00:00:00Z");

        const startDay = startDate.getUTCDay();
        const endDay = endDate.getUTCDay();

        debugOutput.innerHTML = `
            <strong>Debugging Info:</strong><br>
            Start Date: ${startDate.toUTCString()} (Weekday: ${startDay})<br>
            End Date: ${endDate.toUTCString()} (Weekday: ${endDay})<br>
        `;

        console.log("Start Date:", startDate.toUTCString(), "Weekday:", startDay);
        console.log("End Date:", endDate.toUTCString(), "Weekday:", endDay);

        // Monday = 1, Sunday = 0
        if (startDay !== 1) {
            errorMessage.textContent = "Start date must be a Monday.";
            return false;
        }
        if (endDay !== 0) {
            errorMessage.textContent = "End date must be a Sunday.";
            return false;
        }
        if (endDate <= startDate) {
            errorMessage.textContent = "End date must be after the start date.";
            return false;
        }

        errorMessage.textContent = "";

        // âœ… If all checks pass, submit the form
        this.submit();
    });
</script>
{% endblock %}

